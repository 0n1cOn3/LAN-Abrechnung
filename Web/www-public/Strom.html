<!DOCTYPE HTML>
<!--
	Hyperspace by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title id="SideTile"></title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Header -->
			<header id="header">
				<a href="index.html" id="HeaderWelcome" class="title"></a>
				<nav>
					<ul id="LinksList">
					</ul>
				</nav>
			</header>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<section id="main" class="wrapper">
						<div class="inner">
							<h1 class="major" id="MainHeadline"></h1>
							<h3 id="StromText"></h3>
							<canvas id="StromChart" style="display: block; box-sizing: border-box; height: 100px; width: 800px;" width="1200" height="250"></canvas>
						</div>
					</section>

			</div>

		<!-- Footer -->
			<footer id="footer" class="wrapper alt">
				<div class="inner">
					<ul class="menu">
						<li>&copy; LAN-Manager by EBG.PW | All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li><li>Projekt und Dokumentation: <a href="https://github.com/EBG-PW/LAN-Abrechnung">Github</a></li><li>
							<select id="countries" onchange='chanceLanguageEvent()' style="width:280px;">
								<option value='de'>ðŸ‡©ðŸ‡ª German</option>
								<option value='en'>ðŸ‡¬ðŸ‡§ English</option>
								<option value='it'>ðŸ‡®ðŸ‡¹ Italian</option>
								<option value='ua'>ðŸ‡ºðŸ‡¦ Ukranian</option>
							</select>
						</li>
					</ul>
				</div>
			</footer>

		<!-- Scripts -->
			<script>const exports = {};//Fixes i18n Stuff lol.</script>
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/verifyToken.js"></script>
			<script src="assets/js/chart.js"></script>
			<script src="assets/js/i18n.source.js"></script>
			<script src="assets/js/i18n.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="assets/js/BackendCalls.js"></script>
			<script src="assets/js/BuildHTML.js"></script>
			<script src="assets/js/table.js"></script>
			<script src="assets/js/strom_websocket.js"></script>
			<script src="assets/js/htmltables.js"></script>
			<script src="assets/js/buttons.js"></script>
			<script>
				CheckTokenValidity().then(function(TokenData) {
					//This will wirte all Token data to localstorrage to be used in all funktions
					writeTokenDataToLocalStorrage(TokenData)
					//Will create the header based on active and persmissions
					createHeaderLinks("Strom")
					//Will translate a key value to the language of the token
					createHeaderMessage()
					createSiteTitle()
					//Write transladed headline in Main wrapper
					$("#MainHeadline").html(translate('Header.Links.Strom'));
					GeTotalKWH().then(function(TotalKWH) {
						$("#StromText").html(translate('Stromseite.Text', {totalkwh: TotalKWH.kwh, totalkostenkwh: CentToEuro(TotalKWH.kwh*TotalKWH.price)}));
					});
					//Create the chart
					const ws = new WebSocket('ws://localhost:10027');

					ws.send(JSON.stringify({"event": "plug_gethistory", "data_payload": {"plugid": "1", "userid": "206921999"}}));

					ws.onmessage = function(response){
						const responseData = JSON.parse(response.data);
						console.log(responseData);
						//drawChart();
					}
					//createChart()
					const labels = [
						'January',
						'February',
						'March',
						'April',
						'May',
						'June',
						'July',
					];

					const data = {
						labels: labels,
						datasets: [{
						label: 'Power (W)',
						backgroundColor: 'rgb(255, 99, 132)',
						borderColor: 'rgb(255, 99, 132)',
						data: [0, 25, 5, 43, 2, 32, 192],
						}],
						fill: false,
      					tension: 0.4
					};

					const config = {
					type: 'line',
					data: data,
					options: {
						responsive: true,
						plugins: {
						title: {
							display: true,
							text: 'User Power Graph'
						},
						},
						interaction: {
						intersect: false,
						},
						scales: {
						x: {
							display: true,
							title: {
							display: true
							}
						},
						y: {
							display: true,
							title: {
							display: true,
							text: 'Seconds'
							},
							suggestedMin: 0,
							suggestedMax: 200
						}
						}
					},
					};
					const myChart = new Chart(
						document.getElementById('StromChart'),
						config
					);
					setTimeout(function() {
						myChart.data.datasets[0].data = [4,34,75,346,53,436,54];
						myChart.update();
					}, 1000);
				})
			</script>
	</body>
	</body>
</html>